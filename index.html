<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Industrial SCADA | VFD Monitoring</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --primary-dark: #1a1a1a;
        --secondary-dark: #2d2d2d;
        --tertiary-dark: #3d3d3d;
        --primary-yellow: #ffd700;
        --secondary-yellow: #ffc400;
        --accent-yellow: #ffee58;
        --text-light: #f5f5f5;
        --text-gray: #aaaaaa;
        --danger: #ff4444;
        --warning: #ffbb33;
        --success: #00c851;
        --info: #33b5e5;
        --border-radius: 8px;
        --transition: all 0.3s ease;
        --shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        --glow: 0 0 10px rgba(255, 215, 0, 0.6);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--primary-dark);
        color: var(--text-light);
        min-height: 100vh;
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
      }

      /* Header Styles */
      header {
        background: linear-gradient(to right, #000000, var(--primary-dark));
        color: var(--primary-yellow);
        padding: 12px 20px;
        border-bottom: 2px solid var(--primary-yellow);
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: var(--shadow);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 24px;
        font-weight: bold;
        text-shadow: var(--glow);
      }

      .logo i {
        color: var(--primary-yellow);
      }

      .subtitle {
        font-size: 16px;
        color: var(--accent-yellow);
        margin-left: 10px;
      }

      .header-controls {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .header-controls button {
        background: var(--secondary-dark);
        color: var(--text-light);
        border: 1px solid var(--primary-yellow);
        border-radius: 4px;
        padding: 8px 12px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .header-controls button:hover {
        background: var(--primary-yellow);
        color: var(--primary-dark);
      }

      /* Navigation Tabs */
      .nav-tabs {
        display: flex;
        background: linear-gradient(to bottom, #252525, #1e1e1e);
        border-bottom: 2px solid var(--primary-yellow);
        padding: 0 20px;
        overflow-x: auto;
      }

      .tab {
        padding: 15px 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: var(--transition);
        border-bottom: 3px solid transparent;
        white-space: nowrap;
      }

      .tab:hover {
        background: rgba(255, 215, 0, 0.1);
      }

      .tab.active {
        border-bottom: 3px solid var(--primary-yellow);
        background: rgba(255, 215, 0, 0.15);
        color: var(--primary-yellow);
      }

      .tab i {
        font-size: 18px;
      }

      /* Main Content */
      .container {
        position: relative;
        min-height: calc(100vh - 120px);
      }

      .tab-content {
        display: none;
        width: 100%;
        animation: fadeIn 0.5s ease;
      }

      .tab-content.active {
        display: block;
        width: 100%;
        padding: 1%;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* Dashboard Styles */
      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
        width: 100%;
      }

      .card {
        background: var(--secondary-dark);
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: var(--shadow);
        border-left: 4px solid var(--primary-yellow);
        transition: var(--transition);
        width: 100%;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #444;
      }

      .card-title {
        font-size: 18px;
        color: var(--primary-yellow);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .stat-value {
        font-size: 28px;
        font-weight: bold;
        color: var(--text-light);
        margin: 10px 0;
      }

      .stat-label {
        font-size: 14px;
        color: var(--text-gray);
      }

      .stat-trend {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
        margin-top: 5px;
      }

      .trend-up {
        color: var(--success);
      }

      .trend-down {
        color: var(--danger);
      }

      /* VFD Grid */
      .dashboard {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 20px;
        margin-top: 20px;
        width: 100%;
      }

      .sections-panel {
        background-color: var(--secondary-dark);
        border-radius: var(--border-radius);
        padding: 15px;
        box-shadow: var(--shadow);
        height: fit-content;
        border: 1px solid #444;
        width: 100%;
      }

      .sections-panel h2 {
        color: var(--primary-yellow);
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #444;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-item {
        background-color: var(--tertiary-dark);
        margin-bottom: 10px;
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        transition: var(--transition);
        border-left: 4px solid #555;
        width: 100%;
      }

      .section-item:hover {
        background-color: #4d4d4d;
        border-left: 4px solid var(--accent-yellow);
      }

      .section-item.active {
        background-color: #3a2e00;
        border-left: 4px solid var(--primary-yellow);
      }

      .section-name {
        font-weight: bold;
        margin-bottom: 5px;
        color: var(--text-light);
      }

      .section-stats {
        font-size: 12px;
        color: var(--text-gray);
      }

      .vfd-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 20px;
        width: 100%;
      }

      .vfd-item {
        background: linear-gradient(
          to bottom,
          var(--secondary-dark),
          var(--tertiary-dark)
        );
        border-radius: var(--border-radius);
        padding: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--shadow);
        border: 1px solid #444;
        position: relative;
        overflow: hidden;
        width: 100%;
      }

      .vfd-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.6);
        border-color: var(--primary-yellow);
      }

      .vfd-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--primary-yellow);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s ease;
      }

      .vfd-item:hover::before {
        transform: scaleX(1);
      }

      .vfd-status {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
      }

      .status-online {
        background-color: var(--success);
        box-shadow: 0 0 8px var(--success);
      }

      .status-offline {
        background-color: var(--danger);
        box-shadow: 0 0 8px var(--danger);
      }

      .status-warning {
        background-color: var(--warning);
        box-shadow: 0 0 8px var(--warning);
      }

      .vfd-icon {
        width: 50%;
        color: var(--primary-yellow);
      }

      .vfd-id {
        font-weight: bold;
        margin-bottom: 5px;
        color: var(--primary-yellow);
        text-align: center;
      }

      .vfd-model {
        font-size: 12px;
        color: var(--text-gray);
        text-align: center;
      }

      .vfd-stats {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #444;
      }

      .vfd-stat {
        text-align: center;
      }

      .vfd-stat-value {
        font-size: 14px;
        font-weight: bold;
        color: var(--text-light);
      }

      .vfd-stat-label {
        font-size: 10px;
        color: var(--text-gray);
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
        animation: modalFadeIn 0.3s ease;
      }
      @keyframes modalFadeIn {
        from {
          opacity: 0;
          backdrop-filter: blur(0px);
        }
        to {
          opacity: 1;
          backdrop-filter: blur(5px);
        }
      }

      .modal-content {
        background: linear-gradient(to bottom, #2d2d2d, #1f1f1f);
        width: 90%;
        max-width: 1000px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        border: 1px solid var(--primary-yellow);
        display: flex;
        flex-direction: column;
        max-height: 90vh;
        animation: modalSlideIn 0.3s ease;
      }
      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      .modal-header {
        background: linear-gradient(to right, #000000, #2d2d2d);
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid var(--primary-yellow);
      }

      .modal-title {
        font-size: 20px;
        font-weight: bold;
        color: var(--primary-yellow);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .close-btn {
        background: none;
        border: none;
        color: var(--text-light);
        font-size: 24px;
        cursor: pointer;
        transition: var(--transition);
      }

      .close-btn:hover {
        color: var(--primary-yellow);
      }

      .modal-body {
  padding: 20px;
  overflow-y: auto;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}
.modal-card {
  background: var(--secondary-dark);
  border-radius: var(--border-radius);
  padding: 20px;
  box-shadow: var(--shadow);
  border-left: 4px solid var(--primary-yellow);
}
.modal-card.full-width {
  grid-column: 1 / -1;
}

.modal-card h3 {
  color: var(--primary-yellow);
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 1px solid #444;
  display: flex;
  align-items: center;
  gap: 8px;
}

.vfd-details-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px 20px;
}

.detail-group {
  margin-bottom: 15px;
}

.detail-label {
  font-size: 12px;
  color: var(--text-gray);
  margin-bottom: 5px;
  display: flex;
  align-items: center;
  gap: 5px;
}

.detail-value {
  font-size: 20px;
    color: var(--primary-yellow);
  font-weight: bold;
}

.status-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.status-item {
  background: var(--tertiary-dark);
  border-radius: 6px;
  padding: 15px;
  text-align: center;
  border-left: 4px solid var(--primary-yellow);
}

.status-label {
  font-size: 12px;
  color: var(--text-gray);
}

.status-value {
  font-size: 18px;
  font-weight: bold;
  color: var(--primary-yellow);
  margin-top: 5px;
}

.modal-footer {
  padding: 15px 20px;
  background-color: var(--secondary-dark);
  border-top: 1px solid #444;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.vfd-details {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  width: 100%;
      }

      .detail-group {
        margin-bottom: 15px;
        width: 100%;
      }

      .detail-label {
        font-size: 12px;
        color: var(--text-gray);
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .status-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
      }

      .btn {
        padding: 8px 16px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .btn-primary {
        background: var(--primary-yellow);
        color: var(--primary-dark);
      }

      .btn-primary:hover {
        background: var(--secondary-yellow);
      }

      .btn-secondary {
        background: var(--tertiary-dark);
        color: var(--text-light);
        border: 1px solid #555;
      }

      .btn-secondary:hover {
        background: #444;
      }

      /* Alarms Styles */
      .alarms-container {
        margin-top: 20px;
        width: 100%;
      }

      .alarm-item {
        background: var(--secondary-dark);
        border-left: 4px solid var(--danger);
        border-radius: var(--border-radius);
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: var(--transition);
        animation: slideIn 0.3s ease;
        width: 100%;
      }

      .alarm-item.warning {
        border-left-color: var(--warning);
      }

      .alarm-item.info {
        border-left-color: var(--info);
      }

      .alarm-item:hover {
        background: #333;
      }

      .alarm-content {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .alarm-icon {
        font-size: 20px;
      }

      .alarm-critical .alarm-icon {
        color: var(--danger);
      }

      .alarm-warning .alarm-icon {
        color: var(--warning);
      }

      .alarm-info .alarm-icon {
        color: var(--info);
      }

      .alarm-details {
        flex-grow: 1;
      }

      .alarm-title {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .alarm-desc {
        font-size: 14px;
        color: var(--text-gray);
      }

      .alarm-time {
        font-size: 12px;
        color: var(--text-gray);
      }

      /* Map Styles */
      .map-container {
        display: none; /* Hidden by default */
        position: relative;
        width: 100vw;
        height: 100vh;
        background: var(--primary-dark);
      }

      .map-placeholder {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        flex-direction: column;
        color: var(--text-gray);
        width: 100%;
      }

      .map-placeholder i {
        font-size: 48px;
        margin-bottom: 15px;
        color: #555;
      }

      .map-selector {
        margin: 15px 0;
        display: flex;
        gap: 10px;
        align-items: center;
        width: 100%;
      }

      .map-selector select {
        padding: 8px 12px;
        border-radius: 4px;
        background: var(--tertiary-dark);
        color: var(--text-light);
        border: 1px solid #555;
        width: 200px;
      }

      /* SVG Map Styles */
      #svgMapContainer {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: auto;
        background: var(--tertiary-dark);
      }

      #svgMap {
        width: 100%;
        height: 100%;
        min-width: 1920px;
        min-height: 1080px;
      }
/* Dropdown container */
.svg-controls {
  position: absolute;
  top: 0%;
  left: 0%;
  background: rgba(45, 45, 45, 0.9);
  border: 1px solid var(--primary-yellow);
  border-radius: var(--border-radius);
  padding: 8px;
  box-shadow: var(--shadow);
  z-index: 1000;

  /* start collapsed */
  display: flex;
  flex-direction: column;
  align-items: anchor-center;
}

.svg-controls .dropdown-toggle {
  background: var(--secondary-dark);
  color: var(--text-light);
  border: 1px solid var(--primary-yellow);
  border-radius: 4px;
  padding: 8px 12px;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 5px;
}

.svg-controls .dropdown-toggle:hover {
  background: var(--primary-yellow);
  color: var(--primary-dark);
}

/* Buttons container - hidden until hover */
.svg-controls .dropdown-content {
  display: none;
  flex-direction: column;
  gap: 8px;
  margin-top: 10px;
  width: 100%;
}

/* Show the buttons on hover */
.svg-controls:hover .dropdown-content {
  display: flex;
}

.svg-controls .dropdown-content button {
  background: var(--secondary-dark);
  color: var(--text-light);
  border: 1px solid var(--primary-yellow);
  border-radius: 4px;
  padding: 8px 12px;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 5px;
}

.svg-controls .dropdown-content button:hover {
  background: var(--primary-yellow);
  color: var(--primary-dark);
}

      .svg-controls button {
        background: var(--secondary-dark);
        color: var(--text-light);
        border: 1px solid var(--primary-yellow);
        border-radius: 4px;
        padding: 8px 12px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .svg-controls button:hover {
        background: var(--primary-yellow);
        color: var(--primary-dark);
      }

      .svg-controls button.active {
        background: var(--primary-yellow);
        color: var(--primary-dark);
      }

      .svg-controls button.hidden {
        display: none;
      }
      .connection-line {
        animation: dash 1.5s linear infinite;
      }

      @keyframes dash {
        to {
          stroke-dashoffset: -15;
        }
      }

      .machine-hover {
        filter: drop-shadow(0 0 10px var(--primary-yellow));
        animation: pulse-glow 1s ease-in-out infinite alternate;
      }

      @keyframes pulse-glow {
        from {
          filter: drop-shadow(0 0 5px var(--primary-yellow));
        }
        to {
          filter: drop-shadow(0 0 15px var(--primary-yellow));
        }
      }
      /* Add to your existing CSS */
#vfdTooltip {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  line-height: 1.4;
}

#vfdTooltip::before {
  content: '';
  position: absolute;
  top: -5px;
  left: 10px;
  width: 10px;
  height: 10px;
  background: var(--secondary-dark);
  border-left: 2px solid var(--primary-yellow);
  border-top: 2px solid var(--primary-yellow);
  transform: rotate(45deg);
}
      /* SVG element styling */
      .pe-ps {
        cursor: pointer;
        transition: var(--transition);
      }

      .pe-ps:hover {
        filter: drop-shadow(0 0 5px var(--primary-yellow));
      }

      .pe-ps.highlighted {
        filter: drop-shadow(0 0 10px var(--primary-yellow));
      }

      .vfd-status-indicator {
        fill: var(--success);
        stroke: var(--text-light);
        stroke-width: 1;
        r: 40;
      }

      .vfd-status-indicator.offline {
        fill: var(--danger);
      }

      .vfd-status-indicator.warning {
        fill: var(--warning);
      }

      .vfd-status-indicator.online {
        fill: var(--success);
      }

      /* Settings Styles */
      .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
        width: 100%;
      }

      .settings-group {
        background: var(--secondary-dark);
        border-radius: var(--border-radius);
        padding: 20px;
        width: 100%;
      }

      .settings-group-title {
        color: var(--primary-yellow);
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #444;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .form-group {
        margin-bottom: 15px;
        width: 100%;
      }

      .form-label {
        display: block;
        margin-bottom: 5px;
        color: var(--text-light);
      }

      .form-control {
        width: 100%;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #555;
        background: var(--tertiary-dark);
        color: var(--text-light);
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary-yellow);
      }

      /* Search and Filter */
      .search-box {
        display: flex;
        margin-bottom: 20px;
        background: var(--secondary-dark);
        border-radius: var(--border-radius);
        overflow: hidden;
        border: 1px solid #444;
        width: 97%;
        justify-self: center;
      }

      .search-input {
        flex-grow: 1;
        padding: 12px 15px;
        border: none;
        background: transparent;
        color: var(--text-light);
        width: 100%;
      }

      .search-input:focus {
        outline: none;
      }

      .search-button {
        padding: 0 15px;
        background: var(--primary-yellow);
        color: var(--primary-dark);
        border: none;
        cursor: pointer;
      }

      .filter-bar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        width: 100%;
      }

      .filter-button {
        padding: 8px 15px;
        background: var(--tertiary-dark);
        color: var(--text-light);
        border: 1px solid #555;
        border-radius: 20px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .filter-button.active {
        background: var(--primary-yellow);
        color: var(--primary-dark);
        border-color: var(--primary-yellow);
      }

      /* Sections Tab Styles */
      .section-selector {
        margin: 20px 0;
        display: flex;
        gap: 10px;
        align-items: center;
        width: 100%;
      }

      .section-selector select {
        padding: 10px 15px;
        border-radius: 4px;
        background: var(--tertiary-dark);
        color: var(--text-light);
        border: 1px solid #555;
        width: 300px;
        font-size: 16px;
      }

      .section-map-container {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 20px;
        margin-top: 20px;
        width: 100%;
      }

      .section-map {
        background: var(--secondary-dark);
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: var(--shadow);
        border: 1px solid #444;
        min-height: 600px;
        width: 100%;
      }

      .section-vfd-list {
        background: var(--secondary-dark);
        border-radius: var(--border-radius);
        padding: 20px;
        box-shadow: var(--shadow);
        border: 1px solid #444;
        max-height: 500px;
        overflow-y: auto;
        width: 100%;
      }

      .vfd-map-item {
        position: absolute;
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        transition: var(--transition);
      }

      .vfd-map-icon {
        width: 40px;
        height: 40px;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        margin-bottom: 5px;
      }

      .vfd-map-label {
        font-size: 10px;
        color: var(--text-light);
        background: rgba(0, 0, 0, 0.7);
        padding: 2px 5px;
        border-radius: 3px;
        text-align: center;
        max-width: 80px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .vfd-list-item {
        background: var(--tertiary-dark);
        margin-bottom: 10px;
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        transition: var(--transition);
        border-left: 4px solid #555;
        width: 100%;
      }

      .vfd-list-item:hover {
        background-color: #4d4d4d;
        border-left: 4px solid var(--accent-yellow);
      }

      .vfd-list-id {
        font-weight: bold;
        margin-bottom: 5px;
        color: var(--primary-yellow);
      }

      .vfd-list-details {
        font-size: 12px;
        color: var(--text-gray);
      }

      /* Footer */
      footer {
        background: linear-gradient(to right, #000000, var(--primary-dark));
        color: var(--text-light);
        text-align: center;
        display: block;
        position: absolute;
        padding: 10px;
        border-top: 1px solid var(--primary-yellow);
        margin-top: auto;
        width: 100%;
      }

      /* Animations */
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease;
      }

      .slide-in {
        animation: slideIn 0.3s ease;
      }

      /* Developer Modal */
      .developer-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        width: 100%;
      }

      .info-group {
        margin-bottom: 15px;
        width: 100%;
      }

      .info-label {
        font-size: 12px;
        color: var(--text-gray);
        margin-bottom: 5px;
      }

      .info-value {
        font-size: 16px;
        color: var(--primary-yellow);
      }

      /* Responsive Styles */
      @media (max-width: 1024px) {
        .dashboard {
          grid-template-columns: 1fr;
        }

        .vfd-details {
          grid-template-columns: 1fr;
        }

        .developer-info {
          grid-template-columns: 1fr;
        }

        .section-map-container {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .vfd-grid {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
        }

        .nav-tabs {
          overflow-x: auto;
          padding: 0 10px;
        }

        .tab {
          padding: 12px 15px;
          font-size: 14px;
        }

        .header-controls {
          display: none;
        }

        .filter-bar {
          flex-direction: column;
          align-items: flex-start;
        }

        .map-selector {
          flex-direction: column;
          align-items: flex-start;
        }

        .map-selector select {
          width: 100%;
        }

        .section-selector {
          flex-direction: column;
          align-items: flex-start;
        }

        .section-selector select {
          width: 100%;
        }

        .svg-controls {
          flex-direction: column;
          align-items: flex-end;
        }
      }

      /* Animation for status changes */
      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      /* Fullscreen styles */
      .fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
        background: var(--primary-dark);
      }
      .fullscreen modal {
        width: 100%;
        height: 100%;
        z-index: 101;
      }

      .fullscreen #svgMapContainer {
        height: 100vh;
      }

      .fullscreen .svg-controls {
        top: 0px;
        left: 300px;
      }
      .vfd,
      .machine {
        cursor: pointer;
        transition: opacity 0.5s ease, filter 0.3s ease;
      }
      :fullscreen .map-container {
        width: 100vw !important;
        height: 100vh !important;
        background: var(--primary-dark) !important;
      }

      :fullscreen {
        width: 100% !important;
        height: 100% !important;
        overflow: hidden !important;
      }

      :fullscreen body {
        overflow: hidden !important;
      }

      :fullscreen #svgMapContainer {
        width: 100vw !important;
        height: 100vh !important;
      }

      :fullscreen #svgMap {
        width: 100% !important;
        height: 100% !important;
      }

      /* Hide browser UI elements in fullscreen */
      :fullscreen ::-webkit-scrollbar {
        display: none;
      }

      :fullscreen {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      /* Add these styles for VFD labels */
      .vfd-label {
        pointer-events: none;
        user-select: none;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .vfd-label-bg {
        pointer-events: none;
        user-select: none;
      }
      .vfd-section {
  margin-bottom: 25px;
  background: var(--secondary-dark);
  border-radius: 8px;
  padding: 15px 20px;
  border: 1px solid #444;
}

.section-title {
  color: var(--primary-yellow);
  font-size: 18px;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.vfd-details-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px 20px;
}

.status-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.status-item {
  background: var(--tertiary-dark);
  border-radius: 6px;
  padding: 10px 15px;
  text-align: center;
}

.status-label {
  font-size: 12px;
  color: var(--text-gray);
}

.status-value {
  font-size: 16px;
  font-weight: bold;
  color: var(--primary-yellow);
  margin-top: 5px;
}
    </style>
  </head>
  <body>
    <header id="header">
      <div class="logo">
        <i class="fas fa-industry"></i>
        <span>INDUSTRIAL SCADA</span>
        <span class="subtitle">Supervisory Control and Data Acquisition</span>
      </div>
      <div class="header-controls">
        <button><i class="fas fa-user"></i> Admin</button>
        <button id="developerBtn"><i class="fas fa-code"></i> Developer</button>
      </div>
    </header>

    <div class="nav-tabs" id="nav-tabs">
    <div class="tab active" data-tab="dashboard">
        <i class="fas fa-chart-line"></i>
        <span>Dashboard</span>
    </div>
    <div class="tab" data-tab="vfd">
        <i class="fas fa-bolt"></i>
        <span>VFD</span>
    </div>
    <div class="tab" data-tab="alarms">
        <i class="fas fa-exclamation-triangle"></i>
        <span>ALARMS</span>
    </div>
    <div class="tab" data-tab="map">
        <i class="fas fa-map-marked-alt"></i>
        <span>MAP</span>
    </div>
</div>

    <div class="container">
      <!-- Dashboard Tab -->
      <div class="tab-content active" id="dashboard">
        <h2><i class="fas fa-chart-line"></i> System Overview</h2>
        <br />
        <div class="dashboard-grid">
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-bolt"></i> Total VFDs
              </div>
              <i class="fas fa-microchip"></i>
            </div>
            <div class="stat-value">68</div>
            <div class="stat-label">Active Variable Frequency Drives</div>
            <div class="stat-trend trend-up">
              <i class="fas fa-arrow-up"></i>
              <span>4% from last week</span>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-cogs"></i> Machines Online
              </div>
              <i class="fas fa-server"></i>
            </div>
            <div class="stat-value">42</div>
            <div class="stat-label">Out of 68 total machines</div>
            <div class="stat-trend trend-down">
              <i class="fas fa-arrow-down"></i>
              <span>2% from yesterday</span>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-tachometer-alt"></i> Avg. Efficiency
              </div>
              <i class="fas fa-percentage"></i>
            </div>
            <div class="stat-value">87.3%</div>
            <div class="stat-label">Across all production lines</div>
            <div class="stat-trend trend-up">
              <i class="fas fa-arrow-up"></i>
              <span>1.2% from last month</span>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-exclamation-triangle"></i> Active Alarms
              </div>
              <i class="fas fa-bell"></i>
            </div>
            <div class="stat-value">3</div>
            <div class="stat-label">Requiring attention</div>
            <div class="stat-trend trend-down">
              <i class="fas fa-arrow-down"></i>
              <span>50% from yesterday</span>
            </div>
          </div>
        </div>

        <h2><i class="fas fa-bolt"></i> VFD Status Overview</h2>
        <div class="dashboard">
          <div class="sections-panel">
            <h2><i class="fas fa-th-list"></i> Sections</h2>
            <div class="section-list">
              <!-- Sections will be populated by JavaScript -->
            </div>
          </div>

          <div class="main-content">
            <div class="vfd-grid">
              <!-- VFD items will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- VFD Tab -->
      <div class="tab-content" id="vfd">
        <h2><i class="fas fa-bolt"></i> VFD Monitoring</h2>
        <br />
        <div class="search-box">
          <input
            type="text"
            class="search-input"
            id="vfdSearch"
            placeholder="Search VFDs..."
          />
          <button class="search-button"><i class="fas fa-search"></i></button>
        </div>

        <div class="filter-bar">
          <div class="filter-button active" data-filter="all">
            <i class="fas fa-layer-group"></i> All
          </div>
          <div class="filter-button" data-filter="online">
            <i class="fas fa-check-circle"></i> Online
          </div>
          <div class="filter-button" data-filter="warning">
            <i class="fas fa-exclamation-triangle"></i> Warning
          </div>
          <div class="filter-button" data-filter="offline">
            <i class="fas fa-times-circle"></i> Offline
          </div>
          <div class="filter-button" data-filter="sort">
            <i class="fas fa-sort-amount-down"></i> Sort
          </div>
        </div>

        <div class="dashboard">
          <div class="sections-panel">
            <h2><i class="fas fa-th-list"></i> Sections</h2>
            <div class="section-list">
              <!-- Sections will be populated by JavaScript -->
            </div>
          </div>

          <div class="main-content">
            <div class="vfd-grid" id="vfdContainer">
              <!-- VFD items will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- Alarms Tab -->
      <div class="tab-content" id="alarms">
        <h2><i class="fas fa-exclamation-triangle"></i> Alarm Management</h2>

        <div class="filter-bar">
          <div class="filter-button active" data-alarm-filter="all">
            <i class="fas fa-layer-group"></i> All Alarms
          </div>
          <div class="filter-button" data-alarm-filter="critical">
            <i class="fas fa-radiation"></i> Critical
          </div>
          <div class="filter-button" data-alarm-filter="warnings">
            <i class="fas fa-exclamation-circle"></i> Warnings
          </div>
          <div class="filter-button" data-alarm-filter="info">
            <i class="fas fa-info-circle"></i> Info
          </div>
          <div class="filter-button" data-alarm-filter="history">
            <i class="fas fa-history"></i> History
          </div>
        </div>

        <div class="alarms-container" id="alarmsContainer">
          <div class="alarm-item alarm-critical">
            <div class="alarm-content">
              <div class="alarm-icon"><i class="fas fa-radiation"></i></div>
              <div class="alarm-details">
                <div class="alarm-title">Over Temperature - VFD PS-205</div>
                <div class="alarm-desc">
                  Temperature exceeds safe operating limits
                </div>
              </div>
            </div>
            <div class="alarm-time">10:24 AM</div>
          </div>

          <div class="alarm-item alarm-warning">
            <div class="alarm-content">
              <div class="alarm-icon">
                <i class="fas fa-exclamation-circle"></i>
              </div>
              <div class="alarm-details">
                <div class="alarm-title">High Vibration - Motor M-112</div>
                <div class="alarm-desc">
                  Vibration levels above normal range
                </div>
              </div>
            </div>
            <div class="alarm-time">09:45 AM</div>
          </div>

          <div class="alarm-item alarm-info">
            <div class="alarm-content">
              <div class="alarm-icon"><i class="fas fa-info-circle"></i></div>
              <div class="alarm-details">
                <div class="alarm-title">Maintenance Due - VFD PS-211</div>
                <div class="alarm-desc">Scheduled maintenance required</div>
              </div>
            </div>
            <div class="alarm-time">Yesterday</div>
          </div>
        </div>
      </div>

      
      <!-- Updated VFD Modal with Cards -->
      <div class="modal" id="vfdModal">
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title"><i class="fas fa-bolt"></i> VFD DETAILS</div>
            <button class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <!-- Details Card -->
            <div class="modal-card">
              <h3><i class="fas fa-info-circle"></i> EQUIPMENT DETAILS</h3>
              <div class="vfd-details-grid">
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-fingerprint"></i> Equipment ID</div>
                  <div class="detail-value" id="modal-equipment-id">-</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-microchip"></i> VFD Brand / Model</div>
                  <div class="detail-value" id="modal-vfd-model">-</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-cog"></i> Equipment Name</div>
                  <div class="detail-value" id="modal-equipment-name">-</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-align-left"></i> Equipment Details</div>
                  <div class="detail-value" id="modal-equipment-details">-</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-bolt"></i> Power Rating</div>
                  <div class="detail-value" id="modal-power-rating">-</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-plug"></i> Voltage</div>
                  <div class="detail-value" id="modal-voltage">-</div>
                </div>
              </div>
            </div>

            <!-- Live Data Card -->
            <div class="modal-card">
              <h3><i class="fas fa-tachometer-alt"></i> LIVE PERFORMANCE DATA</h3>
              <div class="vfd-details-grid">
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-bullseye"></i> Reference Frequency</div>
                  <div class="detail-value" id="modal-ref-freq">- Hz</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-wave-square"></i> Output Frequency</div>
                  <div class="detail-value" id="modal-output-freq">- Hz</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-bolt"></i> Output Current</div>
                  <div class="detail-value" id="modal-output-current">- A</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-battery-three-quarters"></i> DC Bus Voltage</div>
                  <div class="detail-value" id="modal-dc-voltage">- V</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-cogs"></i> Output Torque</div>
                  <div class="detail-value" id="modal-output-torque">- Nm</div>
                </div>
                <div class="detail-group">
                  <div class="detail-label"><i class="fas fa-plug"></i> Output Power</div>
                  <div class="detail-value" id="modal-output-power">- kW</div>
                </div>
              </div>
            </div>

            <!-- Status Card -->
            <div class="modal-card full-width">
              <h3><i class="fas fa-signal"></i> DEVICE STATUS</h3>
              <div class="status-grid">
                <div class="status-item">
                  <div class="status-label">Running State</div>
                  <div class="status-value" id="modal-running-status">-</div>
                </div>
                <div class="status-item">
                  <div class="status-label">Device Connection</div>
                  <div class="status-value" id="modal-device-status">Offline</div>
                </div>
                <div class="status-item">
                  <div class="status-label">Fault Status</div>
                  <div class="status-value" id="modal-fault-status">-</div>
                </div>
                <div class="status-item">
                  <div class="status-label">Temperature</div>
                  <div class="status-value" id="modal-temperature">- °C</div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <div class="status-indicator">
              <div class="status-dot status-online" id="status-dot"></div>
              <span id="status-text">Online</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Map Tab -->
      <div class="tab-content" id="map">
        <div class="map-container">
          <div id="svgMapContainer">
            <!-- SVG will be embedded here -->
          </div>
        <div class="svg-controls">
            <button class="dropdown-toggle">
                <i class="fas fa-sliders-h"></i>
            </button>
            <div class="dropdown-content">
                <button id="toggleVfd" class="active"><i class="fas fa-bolt"></i> VFD</button>
                <button id="toggleMachine" class="active"><i class="fas fa-cog"></i> MACHINE</button>
                <button id="fullscreenBtn"><i class="fas fa-expand"></i> Fullscreen</button>
                <button id="backBtn" class="hidden"><i class="fas fa-compress"></i>Back</button>
            </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      Treasure Island Industrial Corporation © 2025 BITS – Advanced Industrial
      Monitoring and Control System
    </footer>

    <!-- Modal for VFD Details -->
    <!-- Modal for VFD Details -->

    <!-- Developer Modal -->
    <div class="modal" id="developerModal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title">
            <i class="fas fa-code"></i> Developer Information
          </div>
          <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="developer-info">
            <div>
              <h3><i class="fas fa-user-tie"></i> Admin Details</h3>
              <div class="info-group">
                <div class="info-label">Company</div>
                <div class="info-value">
                  Treasure Island Industrial Corporation
                </div>
              </div>
              <div class="info-group">
                <div class="info-label">Address</div>
                <div class="info-value">
                  123 Industrial Way, Tech City, TC 12345
                </div>
              </div>
              <div class="info-group">
                <div class="info-label">Phone</div>
                <div class="info-value">+1 (555) 123-4567</div>
              </div>
              <div class="info-group">
                <div class="info-label">Email</div>
                <div class="info-value">admin@treasureisland.com</div>
              </div>
            </div>
            <div>
              <h3><i class="fas fa-laptop-code"></i> Developer Details</h3>
              <div class="info-group">
                <div class="info-label">Developed By</div>
                <div class="info-value">BITS Development Team</div>
              </div>
              <div class="info-group">
                <div class="info-label">Contact</div>
                <div class="info-value">dev@bits.example.com</div>
              </div>
              <div class="info-group">
                <div class="info-label">Support</div>
                <div class="info-value">support@bits.example.com</div>
              </div>
              <div class="info-group">
                <div class="info-label">Version</div>
                <div class="info-value">v2.5.1</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // VFD Icon Mapping
      const vfdIconMap = {
        "TECO A510": "teco-a510s.png",
        "TECO AS10": "teco-a510s.png",
        VACON: "vacon.png",
        "HITACHI SJ700": "hitachi-sj7000.png",
        "HITACHI SH1": "hitachi-sh1.png",
        "HITACHI SJ700N": "hitachi-sj700n.png",
        "DANAHE D31-T2-IR5G/2R2P": "danahe-d31.png",
        "FRENIC ACE": "frenic-ace.png",
        "FRENIC MEGA": "frenic-mega.png",
        "TDS V8": "tds-v8.png",
        "TDS F8": "tds-f8.png",
        "ALTIVAR 320": "altivar-320.png",
        "YASKAWA A1000": "yaskawa-a1000.png",
        "CHZIRI V-ZVF300-G030T2M": "chziri.png",
      };
let scadaData = null;

// Fetch SCADA data from JSON file
async function fetchScadaData() {
  try {
    const response = await fetch('DB/scada_data.json');
    if (!response.ok) {
      throw new Error('Failed to load SCADA data');
    }
    scadaData = await response.json();
    return scadaData;
  } catch (error) {
    console.error('Error loading SCADA data:', error);
    // Fallback to empty data structure
    return { sections: [] };
  }
}
      // Get icon filename for VFD model
      function getVfdIcon(model) {
        for (const [key, value] of Object.entries(vfdIconMap)) {
          if (model.includes(key)) {
            return value;
          }
        }

        return "default.png";
      }
      
      // Generate mock real-time data for VFD parameters
      function generateVFDData(equipment_id) {
        // Different VFD models might have different operating ranges
        const baseRanges = {
          "PE-PS-202": {
            freq: 60,
            current: 50,
            voltage: 600,
            torque: 200,
            power: 30,
          },
          "PE-PS-271": {
            freq: 50,
            current: 40,
            voltage: 500,
            torque: 180,
            power: 25,
          },
          "PE-PS-211": {
            freq: 70,
            current: 60,
            voltage: 650,
            torque: 220,
            power: 35,
          },
          "PE-PS-214": {
            freq: 65,
            current: 55,
            voltage: 620,
            torque: 210,
            power: 32,
          },
          "PE-PS-267": {
            freq: 75,
            current: 70,
            voltage: 700,
            torque: 250,
            power: 40,
          },
          "PE-PS-343": {
            freq: 55,
            current: 45,
            voltage: 550,
            torque: 190,
            power: 28,
          },
        };

        // Determine which base range to use
        let baseRange = baseRanges["PE-PS-202"]; // Default
        for (const key in baseRanges) {
          if (equipment_id.includes(key)) {
            baseRange = baseRanges[key];
            break;
          }
        }

        // Generate values with some random variation
        return {
          outputFrequency: (
            Math.random() * baseRange.freq * 0.3 +
            baseRange.freq * 0.7
          ).toFixed(1),
          referenceFrequency: baseRange.freq.toFixed(1),
          outputCurrent: (
            Math.random() * baseRange.current * 0.4 +
            baseRange.current * 0.6
          ).toFixed(1),
          dcBusVoltage: (
            Math.random() * baseRange.voltage * 0.1 +
            baseRange.voltage * 0.9
          ).toFixed(1),
          outputTorque: (
            Math.random() * baseRange.torque * 0.5 +
            baseRange.torque * 0.5
          ).toFixed(1),
          outputPower: (
            Math.random() * baseRange.power * 0.4 +
            baseRange.power * 0.6
          ).toFixed(1),
        };
      }

      // Tab navigation functionality
      function setupTabs() {
        const tabs = document.querySelectorAll(".tab");
        const tabContents = document.querySelectorAll(".tab-content");

        tabs.forEach((tab) => {
          tab.addEventListener("click", () => {
            const tabId = tab.getAttribute("data-tab");

            // Deactivate all tabs
            tabs.forEach((t) => t.classList.remove("active"));
            tabContents.forEach((tc) => tc.classList.remove("active"));

            // Activate current tab
            tab.classList.add("active");
            document.getElementById(tabId).classList.add("active");
            if (tabId !== "dashboard") {
              document.querySelector("footer").style.display = "none";
            }
            if (tabId === "map") {
            initializeSvgMap();
            document.querySelector("footer").style.display = "none";
            const mapContainer = document.querySelector(".map-container");
            mapContainer.style.display = "block";
            mapContainer.parentElement.style.padding = "0%";
            } else {
            document.querySelector("footer").style.display = "block";
            const mapContainer = document.querySelector(".map-container");
            mapContainer.parentElement.style.padding = "1%";
            if (mapContainer) mapContainer.style.display = "none";
            }
          });
        });
      }

      // Display section map with VFD icons
      function displaySectionMap(section) {
        const sectionMap = document.getElementById("sectionMap");
        const sectionVfdList = document.getElementById("sectionVfdList");

        // Clear previous content
        sectionMap.innerHTML = "";
        sectionVfdList.innerHTML =
          '<h3><i class="fas fa-list"></i> VFD List</h3>';

        // Create a grid layout for the map
        sectionMap.style.position = "relative";
        sectionMap.style.minHeight = "500px";
        sectionMap.style.background = "var(--tertiary-dark)";
        sectionMap.style.borderRadius = "var(--border-radius)";

        // Add section title
        const sectionTitle = document.createElement("h3");
        sectionTitle.innerHTML = `<i class="fas fa-map-marked-alt"></i> ${section.name} VFD Layout`;
        sectionTitle.style.color = "var(--primary-yellow)";
        sectionTitle.style.marginBottom = "15px";
        sectionMap.appendChild(sectionTitle);

        // Create VFD items on the map
        section.equipment.forEach((device, index) => {
          // Create map item
          const vfdMapItem = document.createElement("div");
          vfdMapItem.className = "vfd-map-item";

          // Calculate position (distribute evenly in the map area)
          const rows = Math.ceil(Math.sqrt(section.equipment.length));
          const cols = Math.ceil(section.equipment.length / rows);
          const row = Math.floor(index / cols);
          const col = index % cols;

          const top = 60 + row * 100; // 60px for title + spacing
          const left = 20 + col * 120;

          vfdMapItem.style.top = `${top}px`;
          vfdMapItem.style.left = `${left}px`;

          // Get the appropriate icon
          const iconFile = getVfdIcon(device.vfd_brand_model);

          // Create icon element
          const vfdIcon = document.createElement("div");
          vfdIcon.className = "vfd-map-icon";
          vfdIcon.style.backgroundImage = `url(ICON/${iconFile})`;
          vfdIcon.title = device.vfd_brand_model;

          // Create label
          const vfdLabel = document.createElement("div");
          vfdLabel.className = "vfd-map-label";
          vfdLabel.textContent = device.equipment_id;

          // Add status indicator
          const statuses = ["online", "online", "online", "warning", "offline"];
          const randomStatus =
            statuses[Math.floor(Math.random() * statuses.length)];

          const statusIndicator = document.createElement("div");
          statusIndicator.className = `vfd-status status-${randomStatus}`;
          statusIndicator.style.position = "absolute";
          statusIndicator.style.top = "-5px";
          statusIndicator.style.right = "-5px";

          vfdMapItem.appendChild(vfdIcon);
          vfdMapItem.appendChild(vfdLabel);
          vfdMapItem.appendChild(statusIndicator);

          // Add click event to show details
          vfdMapItem.addEventListener("click", () => {
            showVFDDetails(device);
          });

          sectionMap.appendChild(vfdMapItem);

          // Create list item
          const vfdListItem = document.createElement("div");
          vfdListItem.className = "vfd-list-item";
          vfdListItem.innerHTML = `
                    <div class="vfd-list-id">${device.equipment_id}</div>
                    <div class="vfd-list-details">
                        <div>Model: ${device.vfd_brand_model}</div>
                        <div>Power: ${device.power_rating} | Voltage: ${device.voltage}</div>
                    </div>
                `;

          vfdListItem.addEventListener("click", () => {
            showVFDDetails(device);
          });

          sectionVfdList.appendChild(vfdListItem);
        });
      }

      // Populate sections panel
      function populateSections() {
         if (!scadaData || !scadaData.sections) return;
        const sectionList = document.querySelectorAll(".section-list");

        sectionList.forEach((list) => {
          scadaData.sections.forEach((section) => {
            const sectionItem = document.createElement("div");
            sectionItem.className = "section-item";
            sectionItem.innerHTML = `
                        <div class="section-name">${section.name}</div>
                        <div class="section-stats">${section.total_vfds} VFDs, ${section.unique_models} models</div>
                    `;

            sectionItem.addEventListener("click", () => {
              // Remove active class from all sections
              document.querySelectorAll(".section-item").forEach((item) => {
                item.classList.remove("active");
              });

              // Add active class to clicked section
              sectionItem.classList.add("active");

              // Populate VFDs for this section
              populateVFDs(section.equipment);
            });

            list.appendChild(sectionItem);
          });

          // Activate the first section by default
          if (scadaData.sections.length > 0) {
            list.querySelector(".section-item").classList.add("active");
            populateVFDs(scadaData.sections[0].equipment);
          }
        });
      }

      // Populate VFD grid with equipment data
      function populateVFDs(equipment) {
        const vfdGrids = document.querySelectorAll(".vfd-grid");

        vfdGrids.forEach((grid) => {
          grid.innerHTML = ""; // Clear previous content

          equipment.forEach((device) => {
            const statuses = [
              "online",
              "online",
              "online",
              "warning",
              "offline",
            ];
            const randomStatus =
              statuses[Math.floor(Math.random() * statuses.length)];

            const vfdItem = document.createElement("div");
            vfdItem.className = "vfd-item";
            vfdItem.setAttribute("data-status", randomStatus);
            vfdItem.setAttribute("data-name", device.equipment_id);

            // Get the appropriate icon
            const iconFile = getVfdIcon(device.vfd_brand_model);

            vfdItem.innerHTML = `
                        <div class="vfd-status status-${randomStatus}"></div>
                        <div class="vfd-icon">
                            <img src="ICON/${iconFile}" alt="${device.vfd_brand_model}" style="width: 100%; height: 100%;">
                        </div>
                        <div class="vfd-id">${device.equipment_id}</div>
                        <div class="vfd-model">${device.vfd_brand_model}</div>
                        <div class="vfd-stats">
                            <div class="vfd-stat">
                                <div class="vfd-stat-value">${device.power_rating}</div>
                                <div class="vfd-stat-label">POWER</div>
                            </div>
                            <div class="vfd-stat">
                                <div class="vfd-stat-value">${device.voltage}</div>
                                <div class="vfd-stat-label">VOLTAGE</div>
                            </div>
                        </div>
                    `;

            vfdItem.addEventListener("click", () => {
              showVFDDetails(device);
            });

            grid.appendChild(vfdItem);
          });
        });
      }

      // Show modal with VFD details
      // Show modal with VFD details
function showVFDDetails(device) {
  const modal = document.getElementById("vfdModal");
  const vfdData = generateVFDData(device.equipment_id);
  
  // Update details card
  document.getElementById("modal-equipment-id").textContent = device.equipment_id;
  document.getElementById("modal-vfd-model").textContent = device.vfd_brand_model;
  document.getElementById("modal-equipment-name").textContent = device.equipment_name;
  document.getElementById("modal-equipment-details").textContent = device.equipment_details;
  document.getElementById("modal-power-rating").textContent = device.power_rating;
  document.getElementById("modal-voltage").textContent = device.voltage;

  // Update live data card
  document.getElementById("modal-output-freq").textContent = vfdData.outputFrequency + " Hz";
  document.getElementById("modal-ref-freq").textContent = vfdData.referenceFrequency + " Hz";
  document.getElementById("modal-output-current").textContent = vfdData.outputCurrent + " A";
  document.getElementById("modal-dc-voltage").textContent = vfdData.dcBusVoltage + " V";
  document.getElementById("modal-output-torque").textContent = vfdData.outputTorque + " Nm";
  document.getElementById("modal-output-power").textContent = vfdData.outputPower + " kW";

  // Update status card
  document.getElementById("modal-running-status").textContent = vfdData.outputFrequency > 0 ? "Running" : "Stopped";
  document.getElementById("modal-device-status").textContent = "Online";
  document.getElementById("modal-fault-status").textContent = vfdData.outputCurrent > 0.9 * parseFloat(device.power_rating) ? "Overload" : "Normal";

  // Update status indicator
  const statusDot = document.getElementById("status-dot");
  const statusText = document.getElementById("status-text");
  
  statusDot.className = "status-dot status-online";
  statusText.textContent = "Online";

  // Show modal
  modal.style.display = "flex";
}
      function updateGauge(gaugeId, value, max) {
        const percentage = (value / max) * 100;
        const gaugeElement = document.getElementById(gaugeId);
        if (gaugeElement) {
          gaugeElement.style.width = Math.min(percentage, 100) + "%";
        }
      }


function setupModals() {
  const developerBtn = document.getElementById("developerBtn");
  const developerModal = document.getElementById("developerModal");
  const vfdModal = document.getElementById("vfdModal");
  const closeButtons = document.querySelectorAll(".close-btn");

  developerBtn.addEventListener("click", () => {
    developerModal.style.display = "flex";
  });

  closeButtons.forEach((button) => {
    button.addEventListener("click", () => {
      document.querySelectorAll(".modal").forEach((modal) => {
        modal.style.display = "none";
      });
    });
  });

  // Close modal when clicking outside content
  window.addEventListener("click", (event) => {
    document.querySelectorAll(".modal").forEach((modal) => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });
  });

  // Close VFD modal with the Close button in footer
  const vfdCloseBtn = document.querySelector("#vfdModal .btn-primary");
  if (vfdCloseBtn) {
    vfdCloseBtn.addEventListener("click", () => {
      vfdModal.style.display = "none";
    });
  }
}
      // Setup VFD filtering
      function setupVFDFilters() {
        const filterButtons = document.querySelectorAll(
          ".filter-button[data-filter]"
        );
        const vfdSearch = document.getElementById("vfdSearch");
        const vfdContainer = document.getElementById("vfdContainer");

        // Filter button functionality
        filterButtons.forEach((button) => {
          button.addEventListener("click", () => {
            // Remove active class from all filter buttons
            filterButtons.forEach((btn) => btn.classList.remove("active"));

            // Add active class to clicked button
            button.classList.add("active");

            // Apply filter
            const filter = button.getAttribute("data-filter");
            filterVFDs(filter);
          });
        });

        // Search functionality
        vfdSearch.addEventListener("input", () => {
          filterVFDs("search", vfdSearch.value.toLowerCase());
        });
      }

      // Filter VFDs based on criteria
      function filterVFDs(filter, searchTerm = "") {
        const vfdItems = document.querySelectorAll(".vfd-item");

        vfdItems.forEach((item) => {
          let showItem = true;
          const status = item.getAttribute("data-status");
          const name = item.getAttribute("data-name").toLowerCase();

          if (filter === "online" && status !== "online") {
            showItem = false;
          } else if (filter === "warning" && status !== "warning") {
            showItem = false;
          } else if (filter === "offline" && status !== "offline") {
            showItem = false;
          } else if (
            filter === "search" &&
            searchTerm &&
            !name.includes(searchTerm)
          ) {
            showItem = false;
          }

          if (showItem) {
            item.style.display = "flex";
            item.classList.add("slide-in");
          } else {
            item.style.display = "none";
          }
        });
      }

      // Setup alarm filtering
      function setupAlarmFilters() {
        const alarmFilterButtons = document.querySelectorAll(
          ".filter-button[data-alarm-filter]"
        );
        const alarmsContainer = document.getElementById("alarmsContainer");

        alarmFilterButtons.forEach((button) => {
          button.addEventListener("click", () => {
            // Remove active class from all filter buttons
            alarmFilterButtons.forEach((btn) => btn.classList.remove("active"));

            // Add active class to clicked button
            button.classList.add("active");

            // Apply filter
            const filter = button.getAttribute("data-alarm-filter");
            filterAlarms(filter);
          });
        });
      }

      // Filter alarms based on criteria
      function filterAlarms(filter) {
        const alarmItems = document.querySelectorAll(".alarm-item");

        alarmItems.forEach((item) => {
          let showItem = true;

          if (
            filter === "critical" &&
            !item.classList.contains("alarm-critical")
          ) {
            showItem = false;
          } else if (
            filter === "warnings" &&
            !item.classList.contains("alarm-warning")
          ) {
            showItem = false;
          } else if (
            filter === "info" &&
            !item.classList.contains("alarm-info")
          ) {
            showItem = false;
          } else if (filter === "history") {
            // For demonstration, hide all for history (would show historical alarms)
            showItem = false;
          }

          if (showItem) {
            item.style.display = "flex";
            item.classList.add("slide-in");
          } else {
            item.style.display = "none";
          }
        });
      }

      // Setup developer modal
      function setupDeveloperModal() {
        const developerBtn = document.getElementById("developerBtn");
        const developerModal = document.getElementById("developerModal");
        const closeButtons = document.querySelectorAll(".close-btn");

        developerBtn.addEventListener("click", () => {
          developerModal.style.display = "flex";
        });

        closeButtons.forEach((button) => {
          button.addEventListener("click", () => {
            document.querySelectorAll(".modal").forEach((modal) => {
              modal.style.display = "none";
            });
          });
        });

        // Close modal when clicking outside content
        window.addEventListener("click", (event) => {
          document.querySelectorAll(".modal").forEach((modal) => {
            if (event.target === modal) {
              modal.style.display = "none";
            }
          });
        });
      }

      // SVG Map functionality
      function initializeSvgMap() {
        var svgMapContainer = document.getElementById("svgMapContainer");

        // Only initialize if not already done
        if (svgMapContainer.querySelector("svg")) {
          return;
        }

        // Show loading indicator
        svgMapContainer.innerHTML =
          '<div class="map-placeholder"><i class="fas fa-spinner fa-spin"></i><p>Loading map...</p></div>';

        // Fetch and load the external SVG file
        fetch("MAPS/VFD_AND_MOTORS_MAP_SCADA.svg")
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.text();
          })
          .then((svgText) => {
            // Parse the SVG text and insert it into the container
            svgMapContainer.innerHTML = svgText;

            // Add status indicators to VFDs
            addStatusIndicators();

            // Setup SVG interactions
            setupSvgInteractions();
          })
          .catch((error) => {
            console.error("Error loading SVG:", error);
            svgMapContainer.innerHTML =
              '<div class="map-placeholder"><i class="fas fa-exclamation-triangle"></i><p>Error loading map. Please check if the file exists.</p></div>';
          });
      }

      // Add status indicators to VFDs in SVG
      function addStatusIndicators() {
        const pePsGroups = document.querySelectorAll(".pe-ps");

        pePsGroups.forEach((group) => {
          const vfdGroup = group.querySelector(".vfd").children[0];
          if (vfdGroup) {
            // Create status indicator circle
            const statusIndicator = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "circle"
            );
            statusIndicator.setAttribute("class", "vfd-status-indicator");

            // Set status based on random value
            const statuses = [
              "online",
              "online",
              "online",
              "warning",
              "offline",
            ];
            const randomStatus =
              statuses[Math.floor(Math.random() * statuses.length)];
            statusIndicator.classList.add(randomStatus);

            statusIndicator.setAttribute("cx", "450");
            statusIndicator.setAttribute("cy", "60");

            // Add to VFD group
            vfdGroup.appendChild(statusIndicator);
          }
        });
      }

      // Setup SVG interactions
      function setupSvgInteractions() {
        if (!scadaData || !scadaData.sections) return;
        const pePsGroups = document.querySelectorAll(".pe-ps");
        const toggleVfdBtn = document.getElementById("toggleVfd");
        const toggleMachineBtn = document.getElementById("toggleMachine");
        const fullscreenBtn = document.getElementById("fullscreenBtn");
        const backBtn = document.getElementById("backBtn");
        const mapContainer = document.querySelector(".map-container");
        const tooltipManager = setupVfdTooltips();
        toggleVfdBtn.addEventListener("click", () => {
          toggleVfdBtn.classList.toggle("active");
          const vfds = document.querySelectorAll(".vfd");
          vfds.forEach((vfd) => {
            if (toggleVfdBtn.classList.contains("active")) {
              vfd.style.opacity = "0";
              vfd.style.display = "block";
              setTimeout(() => {
                vfd.style.transition = "opacity 0.5s ease";
                vfd.style.opacity = "1";
              }, 10);
            } else {
              vfd.style.transition = "opacity 0.5s ease";
              vfd.style.opacity = "0";
              setTimeout(() => {
                vfd.style.display = "none";
              }, 500);
            }
          });
        });

        toggleMachineBtn.addEventListener("click", () => {
          toggleMachineBtn.classList.toggle("active");
          const machines = document.querySelectorAll(".machine");
          machines.forEach((machine) => {
            if (toggleMachineBtn.classList.contains("active")) {
              machine.style.opacity = "0";
              machine.style.display = "block";
              setTimeout(() => {
                machine.style.transition = "opacity 0.5s ease";
                machine.style.opacity = "1";
              }, 10);
            } else {
              machine.style.transition = "opacity 0.5s ease";
              machine.style.opacity = "0";
              setTimeout(() => {
                machine.style.display = "none";
              }, 500);
            }
          });
        });
document.addEventListener("keyup", function(e) {
    if (e.which === 122) { // F11 key
        e.preventDefault();

        // Check fullscreen state
        if (!document.fullscreenElement) {
            // Not in fullscreen → request fullscreen
            document.documentElement.requestFullscreen();
            document.getElementById("header").style.display="none"
            document.getElementById("nav-tabs").style.display="none"
        } else {
            // In fullscreen → exit fullscreen
            document.exitFullscreen();
            document.getElementById("header").style.display="flex"
            document.getElementById("nav-tabs").style.display="flex"
        }
    }
});

        fullscreenBtn.addEventListener("click", () => {
          if (!document.fullscreenElement) {
            document.getElementById("header").style.display="none"
            document.getElementById("nav-tabs").style.display="none"
        document.documentElement.requestFullscreen();
          } else {
            document.exitFullscreen();
          }
        });


        backBtn.addEventListener("click", () => {
          if (document.fullscreenElement) {
            document.getElementById("header").style.display="flex"
            document.getElementById("nav-tabs").style.display="flex"
            document.exitFullscreen();
          }
        });
// Listen for fullscreen state changes
document.addEventListener("fullscreenchange", function() {
    if (document.fullscreenElement) {
        console.log("Entered fullscreen");
        
            document.getElementById("header").style.display="none"
            document.getElementById("nav-tabs").style.display="none"
        document.getElementById("backBtn").classList.remove("hidden");
        document.getElementById("fullscreenBtn").classList.add("hidden");
    } else {
        console.log("Exited fullscreen");
        // your logic for normal mode here
            document.getElementById("header").style.display="flex"
            document.getElementById("nav-tabs").style.display="flex"
        document.getElementById("backBtn").classList.add("hidden");
        document.getElementById("fullscreenBtn").classList.remove("hidden");
    }
});
        // Setup hover and click interactions for PE-PS groups
        pePsGroups.forEach((group) => {
          const equipmentId = group.id;

          // Find corresponding equipment data
          let equipmentData = null;
          for (const section of scadaData.sections) {
            equipmentData = section.equipment.find(
              (e) => e.equipment_id === equipmentId
            );
            if (equipmentData) break;
          }

          if (!equipmentData) return;

          // Get VFD and Machine elements
          const vfd = group.querySelector(".vfd");
          const machine = group.querySelector(".machine");

          if (!vfd) return;

          // Add hover effect to entire group
          group.addEventListener("mouseenter", () => {
            group.classList.add("highlighted");
            if (vfd) vfd.classList.add("highlighted");
            if (machine) machine.classList.add("highlighted");
                    tooltipManager.showTooltip(event, equipmentData);

          });

          group.addEventListener("mouseleave", () => {
            group.classList.remove("highlighted");
            if (vfd) vfd.classList.remove("highlighted");
            if (machine) machine.classList.remove("highlighted");
                    tooltipManager.hideTooltip();

          });

          // Add click event to VFD to show details
          vfd.addEventListener("click", (e) => {
            e.stopPropagation();
            showVFDDetails(equipmentData);
          });
          
      // Add mousemove to update tooltip position while hovering
      group.addEventListener("mousemove", (event) => {
        tooltipManager.showTooltip(event, equipmentData);
      });

      // Add click event to VFD to show details
      vfd.addEventListener("click", (e) => {
        e.stopPropagation();
        showVFDDetails(equipmentData);
      });

          // Add special hover effect to machine
          if (machine) {
            machine.addEventListener("mouseenter", (e) => {
              e.stopPropagation();
              machine.classList.add("machine-hover");
              if (vfd) vfd.classList.add("machine-hover");
            });

            machine.addEventListener("mouseleave", (e) => {
              e.stopPropagation();
              machine.classList.remove("machine-hover");
              if (vfd) vfd.classList.remove("machine-hover");
            });
          }
        });
      }

      // Initialize the application
     // Initialize the application
document.addEventListener("DOMContentLoaded", async () => {
  // Load SCADA data first
   await fetchScadaData(); // Ensure this completes first
  
  // Then setup everything else
  setupTabs();
  populateSections();// Add this
  setupVFDFilters();
  setupAlarmFilters();
  setupModals();
  setupPageVisibility(); // Add this
  
  // Initialize SVG map if on map tab
  if (document.getElementById("map").classList.contains("active")) {
    initializeSvgMap();
  }

  // Simulate real-time updates
  setInterval(() => {
    if (!scadaData || !scadaData.sections) return;
    
    const activeSection = document.querySelector(".section-item.active");
    if (activeSection) {
      const sectionIndex = Array.from(
        document.querySelectorAll(".section-item")
      ).indexOf(activeSection);
      populateVFDs(scadaData.sections[sectionIndex].equipment);
    }

    // Update SVG status indicators
    updateSvgStatusIndicators();
  }, 10000);
});

      // Update SVG status indicators
      function updateSvgStatusIndicators() {
        const statusIndicators = document.querySelectorAll(
          ".vfd-status-indicator"
        );

        statusIndicators.forEach((indicator) => {
          // Remove existing status classes
          indicator.classList.remove("online", "warning", "offline");

          // Set new random status
          const statuses = ["online", "online", "online", "warning", "offline"];
          const randomStatus =
            statuses[Math.floor(Math.random() * statuses.length)];
          indicator.classList.add(randomStatus);
        });
      }
      // Add this function to handle page visibility changes
      function setupPageVisibility() {
        // Reset UI when page becomes visible again (like when coming back from another tab)
        document.addEventListener("visibilitychange", () => {
          if (!document.hidden) {
            const activeTab = document.querySelector(".tab.active");
            if (activeTab) {
              if (activeTab.getAttribute("data-tab") !== "dashboard") {
                document.querySelector("footer").style.display = "none";
              }
          }   
          }
        });
      }
      // Add this function after the other helper functions
      function vfdLabel() {
        const vfdElements = document.querySelectorAll(".vfd");

        vfdElements.forEach((vfd) => {
          // Check if label already exists
          if (
            vfd.querySelector(".vfd-label") ||
            vfd.closest(".pe-ps").querySelector(".vfd-label")
          ) {
            return;
          }

          const pePsGroup = vfd.closest(".pe-ps");
          if (!pePsGroup) return;

          const equipmentId = pePsGroup.getAttribute("equipment_id");
          if (!equipmentId) return;

          // Get VFD position and dimensions
          const vfdX = parseFloat(vfd.getAttribute("x"));
          const vfdY = parseFloat(vfd.getAttribute("y"));
          const vfdWidth = parseFloat(vfd.getAttribute("width"));
          const vfdHeight = parseFloat(vfd.getAttribute("height"));

          // Calculate center position
          const centerX = vfdX + vfdWidth / 2;
          const labelY = vfdY + vfdHeight + 15; // 15px below the VFD

          // Create background rectangle
          const background = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "rect"
          );
          background.setAttribute("class", "vfd-label-bg");
          background.setAttribute("x", centerX - (equipmentId.length * 3 + 4));
          background.setAttribute("y", labelY - 8);
          background.setAttribute("width", equipmentId.length * 6 + 8);
          background.setAttribute("height", "14");
          background.setAttribute("fill", "rgba(0, 0, 0, 0.8)");
          background.setAttribute("rx", "3");
          background.setAttribute("stroke", "var(--primary-yellow)");
          background.setAttribute("stroke-width", "1");

          // Create text label
          const label = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          label.setAttribute("class", "vfd-label");
          label.setAttribute("x", centerX);
          label.setAttribute("y", labelY);
          label.setAttribute("text-anchor", "middle");
          label.setAttribute("fill", "var(--primary-yellow)");
          label.setAttribute("font-size", "10");
          label.setAttribute("font-weight", "bold");
          label.setAttribute("pointer-events", "none");
          label.textContent = equipmentId;

          // Add to the parent group
          pePsGroup.appendChild(background);
          pePsGroup.appendChild(label);
        });
      }
      toggleVfdBtn.addEventListener("click", () => {
        toggleVfdBtn.classList.toggle("active");
        const vfds = document.querySelectorAll(".vfd");
        const labels = document.querySelectorAll(".vfd-label, .vfd-label-bg");

        vfds.forEach((vfd) => {
          if (toggleVfdBtn.classList.contains("active")) {
            vfd.style.opacity = "0";
            vfd.style.display = "block";
            setTimeout(() => {
              vfd.style.transition = "opacity 0.5s ease";
              vfd.style.opacity = "1";
            }, 10);
          } else {
            vfd.style.transition = "opacity 0.5s ease";
            vfd.style.opacity = "0";
            setTimeout(() => {
              vfd.style.display = "none";
            }, 500);
          }
        });

        // Also show/hide labels with the same animation
        labels.forEach((label) => {
          if (toggleVfdBtn.classList.contains("active")) {
            label.style.opacity = "0";
            label.style.display = "block";
            setTimeout(() => {
              label.style.transition = "opacity 0.5s ease";
              label.style.opacity = "1";
            }, 10);
          } else {
            label.style.transition = "opacity 0.5s ease";
            label.style.opacity = "0";
            setTimeout(() => {
              label.style.display = "none";
            }, 500);
          }
        });
      });
      function positionTooltip(event, tooltip) {
    const tooltipRect = tooltip.getBoundingClientRect();
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;
    
    const cursorX = event.clientX;
    const cursorY = event.clientY;
    
    // Default offset from cursor
    const offset = 15;
    
    // Calculate available space in each direction
    const spaceRight = viewportWidth - cursorX - offset;
    const spaceLeft = cursorX - offset;
    const spaceBottom = viewportHeight - cursorY - offset;
    const spaceTop = cursorY - offset;
    
    let tooltipX, tooltipY;
    
    // Determine horizontal position
    if (spaceRight >= tooltipRect.width) {
        // Enough space on the right - place to the right of cursor
        tooltipX = cursorX + offset;
    } else if (spaceLeft >= tooltipRect.width) {
        // Enough space on the left - place to the left of cursor
        tooltipX = cursorX - offset - tooltipRect.width;
    } else {
        // Not enough space on either side - center horizontally
        tooltipX = Math.max(10, (viewportWidth - tooltipRect.width) / 2);
    }
    
    // Determine vertical position
    if (spaceBottom >= tooltipRect.height) {
        // Enough space below - place below cursor
        tooltipY = cursorY + offset;
    } else if (spaceTop >= tooltipRect.height) {
        // Enough space above - place above cursor
        tooltipY = cursorY - offset - tooltipRect.height;
    } else {
        // Not enough space above or below - center vertically
        tooltipY = Math.max(10, (viewportHeight - tooltipRect.height) / 2);
    }
    
    // Apply positions
    tooltip.style.left = tooltipX + 'px';
    tooltip.style.top = tooltipY + 'px';
}

function setupVfdTooltips() {
    // Create tooltip element
    const tooltip = document.createElement('div');
    tooltip.id = 'vfdTooltip';
    tooltip.style.cssText = `
        position: fixed;
        background: var(--secondary-dark);
        border: 2px solid var(--primary-yellow);
        border-radius: var(--border-radius);
        padding: 15px;
        color: var(--text-light);
        font-size: 14px;
        z-index: 1000;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
        box-shadow: var(--shadow);
        min-width: 250px;
        backdrop-filter: blur(5px);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.4;
    `;
    
    // Add tooltip to the body instead of SVG container for better positioning
    document.body.appendChild(tooltip);

    // Function to show tooltip
    function showTooltip(event, equipmentData) {
        if (!equipmentData) return;
        
        const vfdData = generateVFDData(equipmentData.equipment_id);
        
        // Create tooltip content
        tooltip.innerHTML = `
            <div style="margin-bottom: 10px; border-bottom: 1px solid var(--primary-yellow); padding-bottom: 8px;">
                <strong style="color: var(--primary-yellow); font-size: 16px;">${equipmentData.equipment_id}</strong>
                <div style="font-size: 12px; color: var(--text-gray);">${equipmentData.equipment_name}</div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                <div>
                    <div style="font-size: 11px; color: var(--text-gray);">Output Freq</div>
                    <div style="color: var(--accent-yellow); font-weight: bold;">${vfdData.outputFrequency} Hz</div>
                </div>
                <div>
                    <div style="font-size: 11px; color: var(--text-gray);">Output Current</div>
                    <div style="color: var(--accent-yellow); font-weight: bold;">${vfdData.outputCurrent} A</div>
                </div>
                <div>
                    <div style="font-size: 11px; color: var(--text-gray);">DC Bus Voltage</div>
                    <div style="color: var(--accent-yellow); font-weight: bold;">${vfdData.dcBusVoltage} V</div>
                </div>
                <div>
                    <div style="font-size: 11px; color: var(--text-gray);">Output Power</div>
                    <div style="color: var(--accent-yellow); font-weight: bold;">${vfdData.outputPower} kW</div>
                </div>
                <div>
                    <div style="font-size: 11px; color: var(--text-gray);">Running State</div>
                    <div style="color: ${vfdData.outputFrequency > 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                        ${vfdData.outputFrequency > 0 ? 'Running' : 'Stopped'}
                    </div>
                </div>
                <div>
                    <div style="font-size: 11px; color: var(--text-gray);">Temperature</div>
                    <div style="color: var(--accent-yellow); font-weight: bold;">${(Math.random() * 20 + 40).toFixed(1)} °C</div>
                </div>
            </div>
        `;

        // Make tooltip visible first to get its dimensions
        tooltip.style.opacity = '1';
        
        // Position the tooltip intelligently
        positionTooltip(event, tooltip);
    }

    // Function to hide tooltip
    function hideTooltip() {
        tooltip.style.opacity = '0';
    }

    // Function to update tooltip position
    function updateTooltipPosition(event) {
        if (tooltip.style.opacity === '1') {
            positionTooltip(event, tooltip);
        }
    }

    // Add event listeners to document for mouse movement
    document.addEventListener('mousemove', updateTooltipPosition);

    return {
        showTooltip,
        hideTooltip
    };
}
    </script>
  </body>
</html>
